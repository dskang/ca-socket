var all_sockets = null;

exports.set_sockets = function  (sockets) {
  all_sockets = sockets;
};

exports.connect_chatter = function  (config) {

    var user;
    config.socket.emit('ready', {});

    config.socket.on('name', function(user) {
	    user = user;
	    config.socket.emit('entrance', {message: 'Welcome to the chat room, ' + user.name + '!'});
	    all_sockets.emit('entrance', {message: user.name + ' is online.'});
	});

    config.socket.on('disconnect', function  () {
	    all_sockets.emit('exit', {message: user.name + ' has disconnected.'});
	});
    
    config.socket.on('chat', function  (data) {
	    all_sockets.emit('chat', {message: user.name + ' says: ' + data.message});
	});
};

exports.failure = function  (socket) {
    socket.emit('error', {message: 'Please log in to the chatroom.'});
};
